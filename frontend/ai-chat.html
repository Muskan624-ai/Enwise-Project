<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat - ENWISE</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="enhanced-styles.css">
</head>
<body class="ai-chat-page">
    <div class="container">
        <!-- Header -->
        <header class="header">
            <a href="index.html" class="logo">
                <span class="logo-text">EnWise</span>
            </a>
            <nav class="nav">
                <a href="index.html" class="nav-link">Home</a>
                <a href="dashboard.html" class="nav-link">Dashboard</a>

                <a href="ai-chat.html" class="nav-link active">AI-Tutor</a>
            </nav>
            <button class="profile-btn">Student profile</button>
            
            <!-- Hamburger Menu -->
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </header>

        <!-- Mobile Navigation Overlay -->
        <div class="nav-overlay" id="navOverlay"></div>
        
        <!-- Mobile Navigation -->
        <nav class="nav-mobile" id="navMobile">
            <a href="index.html" class="nav-link">Home</a>
            <a href="dashboard.html" class="nav-link">Dashboard</a>

            <a href="ai-chat.html" class="nav-link active">AI-Tutor</a>
            <button class="profile-btn">Student profile</button>
        </nav>

        <!-- Main Chat Content -->
        <main class="ai-chat-main">
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-title">
                        <span class="chat-icon">ü§ñ</span>
                        <div>
                            <h1>Study Assistant AI</h1>
                            <p class="chat-status">Always here to help</p>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="chat-action-btn" onclick="clearChatHistory()">üóëÔ∏è Clear</button>
                        <button class="chat-action-btn" onclick="exportChat()">üì• Export</button>
                    </div>
                </div>

                <!-- Chat Messages Area -->
                <div class="chat-messages-full">
                    <div class="message welcome-message">
                        <div class="message-avatar">ü§ñ</div>
                        <div class="message-content">
                            <h3>Welcome to Your Comprehensive AI Tutor! üéì</h3>
                            <p>I can help you with <strong>any subject, any question</strong> - from theory to numericals!</p>
                            
                            <div style="margin: 1rem 0;">
                                <strong>üìö Subjects I Cover:</strong>
                                <ul style="margin: 0.5rem 0; columns: 2;">
                                    <li>Mathematics & Calculus</li>
                                    <li>Physics & Chemistry</li>
                                    <li>Computer Science</li>
                                    <li>Biology & Life Sciences</li>
                                    <li>Economics & Business</li>
                                    <li>Statistics & Probability</li>
                                </ul>
                            </div>
                            
                            <div style="margin: 1rem 0;">
                                <strong>üí° What I Provide:</strong>
                                <ul style="margin: 0.5rem 0;">
                                    <li>‚úÖ Step-by-step numerical solutions</li>
                                    <li>‚úÖ Real-life examples & applications</li>
                                    <li>‚úÖ Conceptual explanations</li>
                                    <li>‚úÖ Code examples & algorithms</li>
                                    <li>‚úÖ Study strategies & exam tips</li>
                                </ul>
                            </div>
                            
                            <p style="margin-top: 1rem; color: #2d8a6e; font-weight: 600;">
                                Try: "Solve: ‚à´x¬≤dx" or "Explain Newton's laws with real examples"
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Chat Input Area -->
                <div class="chat-input-full-area">
                    <div class="input-suggestions">
                        <button class="suggestion-btn" onclick="sendPredefinedMessage('Solve: derivative of x¬≥ + 5x¬≤ - 3x')">üî¢ Solve Derivative</button>
                        <button class="suggestion-btn" onclick="sendPredefinedMessage('Explain photosynthesis with real example')">üå± Photosynthesis</button>
                        <button class="suggestion-btn" onclick="sendPredefinedMessage('Binary search algorithm with code')">üíª Binary Search</button>
                        <button class="suggestion-btn" onclick="sendPredefinedMessage('Calculate compound interest formula')">üí∞ Compound Interest</button>
                        <button class="suggestion-btn" onclick="sendPredefinedMessage('Newton second law with numerical example')">‚ö° Newton's Law</button>
                    </div>
                    
                    <div class="chat-input-area-full">
                        <input type="text" class="chat-input-full" placeholder="Ask anything - theory, numericals, real-life examples... üéì" id="aiChatInput">
                        <button class="send-btn-full" onclick="sendAIChatMessage()">Send ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- Sidebar with Quick Links -->
            <aside class="chat-sidebar">
                <div class="sidebar-section">
                    <h3>üìö Subject Help</h3>
                    <a href="subject.html?subject=Calculus" class="sidebar-link">Calculus</a>
                    <a href="subject.html?subject=Data%20Structures" class="sidebar-link">Data Structures</a>
                    <a href="subject.html?subject=Data%20Science" class="sidebar-link">Data Science</a>
                    <a href="subject.html?subject=Web%20Development" class="sidebar-link">Web Development</a>
                </div>

                <div class="sidebar-section">
                    <h3>‚ö° Quick Actions</h3>
                    <button class="sidebar-btn" onclick="window.location.href='upload.html'">üì§ Upload Material</button>
                    <button class="sidebar-btn" onclick="window.location.href='timetable.html'">üìÖ View Schedule</button>
                    <button class="sidebar-btn" onclick="window.location.href='dashboard.html'">üìä Dashboard</button>
                </div>

                <div class="sidebar-section">
                    <h3>üí¨ Chat History</h3>
                    <div class="chat-history-list" id="chatHistory">
                        <p class="empty-history">No previous chats</p>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <script src="script.js"></script>
    <script>
        // Backend API Configuration
        const CHAT_API_URL = 'http://localhost:8000';
        
        // AI Chat page specific functions
        async function sendAIChatMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const chatMessages = document.querySelector('.chat-messages-full');
            
            // Add user message
            const userMsgDiv = document.createElement('div');
            userMsgDiv.className = 'message user-message-full';
            userMsgDiv.innerHTML = `
                <div class="message-avatar">üë§</div>
                <div class="message-content">
                    <p>${message}</p>
                </div>
            `;
            chatMessages.appendChild(userMsgDiv);
            
            input.value = '';
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Show typing indicator
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message typing-indicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">ü§ñ</div>
                <div class="message-content">
                    <div class="typing-dots">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            try {
                // Connect to real backend
                const response = await fetch(`${CHAT_API_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: message,
                        subject: '',
                        language: 'auto',
                        context: ''
                    })
                });
                
                typingDiv.remove();
                
                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.response || data.message || 'Sorry, I could not process your request.';
                
                const aiMsgDiv = document.createElement('div');
                aiMsgDiv.className = 'message ai-message-full';
                aiMsgDiv.innerHTML = `
                    <div class="message-avatar">ü§ñ</div>
                    <div class="message-content">
                        <p>${aiResponse.replace(/\n/g, '<br>')}</p>
                        <small class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</small>
                    </div>
                `;
                chatMessages.appendChild(aiMsgDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
            } catch (error) {
                typingDiv.remove();
                console.error('Chat API Error:', error);
                
                // Show error message
                const errorMsgDiv = document.createElement('div');
                errorMsgDiv.className = 'message ai-message-full';
                errorMsgDiv.innerHTML = `
                    <div class="message-avatar">‚ö†Ô∏è</div>
                    <div class="message-content">
                        <p><strong>Connection Error</strong><br>
                        Could not connect to AI backend. Please ensure the backend server is running on ${CHAT_API_URL}<br><br>
                        <em>Error: ${error.message}</em></p>
                        <small class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</small>
                    </div>
                `;
                chatMessages.appendChild(errorMsgDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }
        
        function sendPredefinedMessage(message) {
            const input = document.getElementById('aiChatInput');
            input.value = message;
            sendAIChatMessage();
        }
        
        function clearChatHistory() {
            if (confirm('Clear all chat messages?')) {
                document.querySelector('.chat-messages-full').innerHTML = `
                    <div class="message welcome-message">
                        <div class="message-avatar">ü§ñ</div>
                        <div class="message-content">
                            <h3>Welcome to Study Assistant!</h3>
                            <p>I'm here to help you learn and understand concepts better.</p>
                        </div>
                    </div>
                `;
            }
        }
        
        function exportChat() {
            alert('Chat exported! Check your downloads folder.');
        }
        
        // Enable Enter key to send
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('aiChatInput');
            if (input) {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendAIChatMessage();
                    }
                });
            }
        });
    </script>
</body>
</html>
